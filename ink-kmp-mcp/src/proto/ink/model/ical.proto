syntax = "proto3";
package ink.model;

option csharp_namespace = "Ink.Cs.Model";

// iCalendar RFC 5545 types.
// Maps iCal4j Java objects to cross-platform proto messages.
// Used by: InkCalendarEngine, story timeline UI, MAUI calendar views.
//
// References:
//   RFC 5545 — Internet Calendaring and Scheduling (iCalendar)
//   RFC 5546 — iTIP: iCalendar Transport-Independent Interoperability Protocol
//   RFC 7986 — New Properties for iCalendar
//   RFC 9073 — Event Publishing Extensions to iCalendar

// ── Enums ────────────────────────────────────────────────────────

enum EventStatus {
  EVENT_STATUS_UNSPECIFIED = 0;
  TENTATIVE = 1;
  CONFIRMED = 2;
  CANCELLED = 3;
}

enum TodoStatus {
  TODO_STATUS_UNSPECIFIED = 0;
  NEEDS_ACTION = 1;
  COMPLETED = 2;
  IN_PROCESS = 3;
  TODO_CANCELLED = 4;
}

enum ParticipationStatus {
  PARTSTAT_UNSPECIFIED = 0;
  ACCEPTED = 1;
  DECLINED = 2;
  TENTATIVE_PARTSTAT = 3;
  DELEGATED = 4;
  NEEDS_ACTION_PARTSTAT = 5;
}

enum ParticipantRole {
  ROLE_UNSPECIFIED = 0;
  CHAIR = 1;
  REQ_PARTICIPANT = 2;         // Required participant
  OPT_PARTICIPANT = 3;         // Optional participant
  NON_PARTICIPANT = 4;
}

enum RecurrenceFrequency {
  FREQ_UNSPECIFIED = 0;
  SECONDLY = 1;
  MINUTELY = 2;
  HOURLY = 3;
  DAILY = 4;
  WEEKLY = 5;
  MONTHLY = 6;
  YEARLY = 7;
}

enum Weekday {
  WEEKDAY_UNSPECIFIED = 0;
  MO = 1;
  TU = 2;
  WE = 3;
  TH = 4;
  FR = 5;
  SA = 6;
  SU = 7;
}

enum AlarmAction {
  ALARM_ACTION_UNSPECIFIED = 0;
  DISPLAY = 1;                 // Display notification
  AUDIO = 2;                   // Play sound
  EMAIL = 3;                   // Send email
}

enum Transparency {
  TRANSP_UNSPECIFIED = 0;
  OPAQUE = 1;                  // Blocks time
  TRANSPARENT = 2;             // Does not block time
}

enum AccessClassification {
  CLASS_UNSPECIFIED = 0;
  PUBLIC = 1;
  PRIVATE = 2;
  CONFIDENTIAL = 3;
}

// ── Recurrence Rule (RRULE, RFC 5545 §3.3.10) ───────────────────

message WeekdayNum {
  int32 ordinal = 1;            // -1 = last, 1 = first, etc. (0 = every)
  Weekday day = 2;
}

message RecurrenceRule {
  RecurrenceFrequency freq = 1;
  int32 interval = 2;           // Default 1
  int32 count = 3;              // Number of occurrences (0 = unlimited)
  string until = 4;             // End date (ISO 8601, exclusive with count)
  repeated WeekdayNum by_day = 5;       // BYDAY
  repeated int32 by_month_day = 6;      // BYMONTHDAY (-31..31)
  repeated int32 by_year_day = 7;       // BYYEARDAY (-366..366)
  repeated int32 by_week_no = 8;        // BYWEEKNO (-53..53)
  repeated int32 by_month = 9;          // BYMONTH (1..12)
  repeated int32 by_set_pos = 10;       // BYSETPOS (-366..366)
  Weekday week_start = 11;              // WKST (default MO)
  repeated int32 by_hour = 12;          // BYHOUR (0..23)
  repeated int32 by_minute = 13;        // BYMINUTE (0..59)
  repeated int32 by_second = 14;        // BYSECOND (0..60)
}

// ── Attendee (ATTENDEE, RFC 5545 §3.8.4.1) ──────────────────────

message Attendee {
  string cal_address = 1;       // mailto:user@example.com
  string common_name = 2;       // CN parameter
  ParticipantRole role = 3;
  ParticipationStatus partstat = 4;
  bool rsvp = 5;
  string delegated_from = 6;    // DELEGATED-FROM
  string delegated_to = 7;      // DELEGATED-TO
  string sent_by = 8;           // SENT-BY
}

// ── Organizer (ORGANIZER, RFC 5545 §3.8.4.3) ────────────────────

message Organizer {
  string cal_address = 1;       // mailto:organizer@example.com
  string common_name = 2;       // CN parameter
  string sent_by = 3;
}

// ── Alarm (VALARM, RFC 5545 §3.6.6) ─────────────────────────────

message Alarm {
  AlarmAction action = 1;
  string trigger = 2;           // ICalDuration before event (e.g. "-PT15M") or absolute datetime
  bool trigger_absolute = 3;    // true = trigger is absolute datetime
  string description = 4;       // Display text or email body
  string summary = 5;           // Email subject (when action=EMAIL)
  int32 repeat_count = 6;       // REPEAT
  string repeat_duration = 7;   // DURATION between repeats
}

// ── ICalDuration (RFC 5545 §3.3.6) ──────────────────────────────────

message ICalDuration {
  bool negative = 1;
  int32 weeks = 2;
  int32 days = 3;
  int32 hours = 4;
  int32 minutes = 5;
  int32 seconds = 6;
}

// ── Geo (GEO, RFC 5545 §3.8.1.6) ────────────────────────────────

message GeoPosition {
  double latitude = 1;
  double longitude = 2;
}

// ── VEVENT (RFC 5545 §3.6.1) ────────────────────────────────────
// Superset of InkEvent — includes all RFC 5545 event properties.

message VEvent {
  // Identification
  string uid = 1;
  int32 sequence = 2;           // SEQUENCE — modification counter

  // Date/Time
  string dt_start = 3;          // ISO 8601 (with optional TZID)
  string dt_end = 4;            // Exclusive with duration
  ICalDuration duration = 5;
  string dt_stamp = 6;          // DTSTAMP — creation timestamp

  // Description
  string summary = 7;
  string description = 8;
  string location = 9;
  GeoPosition geo = 10;
  string url = 11;

  // Status & Classification
  EventStatus status = 12;
  AccessClassification classification = 13;
  Transparency transp = 14;
  int32 priority = 15;          // 0 = undefined, 1 = highest, 9 = lowest

  // Categories & Resources
  repeated string categories = 16;
  repeated string resources = 17;

  // Participants
  Organizer organizer = 18;
  repeated Attendee attendees = 19;

  // Recurrence (RFC 5545 §3.8.5)
  RecurrenceRule rrule = 20;
  repeated string rdate = 21;   // RDATE — additional recurrence dates
  repeated string exdate = 22;  // EXDATE — exception dates
  string recurrence_id = 23;    // RECURRENCE-ID — override instance

  // Alarms
  repeated Alarm alarms = 24;

  // Timestamps
  string created = 25;          // CREATED
  string last_modified = 26;    // LAST-MODIFIED

  // Relationships
  string related_to = 27;       // RELATED-TO — parent UID
  repeated string attachments = 28; // ATTACH — URIs

  // RFC 7986 Extensions
  string color = 29;            // COLOR — display color
  repeated string conferences = 30; // CONFERENCE — video/voice URIs
}

// ── VTODO (RFC 5545 §3.6.2) ─────────────────────────────────────

message VTodo {
  string uid = 1;
  int32 sequence = 2;

  string dt_start = 3;
  string due = 4;               // DUE — completion deadline
  ICalDuration duration = 5;
  string completed = 6;         // COMPLETED — actual completion datetime

  string summary = 7;
  string description = 8;
  string location = 9;

  TodoStatus status = 10;
  AccessClassification classification = 11;
  int32 priority = 12;
  int32 percent_complete = 13;  // PERCENT-COMPLETE (0..100)

  repeated string categories = 14;
  Organizer organizer = 15;
  repeated Attendee attendees = 16;

  RecurrenceRule rrule = 17;
  repeated Alarm alarms = 18;

  string created = 19;
  string last_modified = 20;
  string related_to = 21;
}

// ── VJOURNAL (RFC 5545 §3.6.3) ──────────────────────────────────

message VJournal {
  string uid = 1;
  int32 sequence = 2;

  string dt_start = 3;          // Date of journal entry

  string summary = 4;
  string description = 5;

  EventStatus status = 6;       // DRAFT, FINAL, CANCELLED
  AccessClassification classification = 7;

  repeated string categories = 8;
  Organizer organizer = 9;
  repeated Attendee attendees = 10;

  RecurrenceRule rrule = 11;

  string created = 12;
  string last_modified = 13;
  string related_to = 14;
}

// ── VCALENDAR (RFC 5545 §3.4) ───────────────────────────────────

message VCalendar {
  string prod_id = 1;           // PRODID — producer identifier
  string version = 2;           // VERSION — "2.0"
  string cal_scale = 3;         // CALSCALE — "GREGORIAN"
  string method = 4;            // METHOD — iTIP method (PUBLISH, REQUEST, etc.)

  // RFC 7986 Extensions
  string name = 5;              // NAME — display name
  string description = 6;
  string color = 7;             // COLOR — display color
  string source = 8;            // SOURCE — subscription URL
  string refresh_interval = 9;  // REFRESH-INTERVAL — subscription refresh

  // Components
  repeated VEvent events = 10;
  repeated VTodo todos = 11;
  repeated VJournal journals = 12;
}
