syntax = "proto3";
package ink.vcard.model;

option java_package = "ink.vcard.model";
option java_multiple_files = true;
option csharp_namespace = "Ink.Vcard.Model";

// vCard RFC 6350 + jCard RFC 7095 types.
// Maps ezvcard Java objects to cross-platform proto messages.
// Used by: InkVCardEngine, InkAuthEngine (jCard-in-JWT), MAUI contacts UI.
//
// References:
//   RFC 6350 — vCard Format Specification (v4.0)
//   RFC 7095 — jCard: The JSON Format for vCard
//   RFC 6474 — vCard Place of Birth/Death Extensions
//   RFC 6715 — vCard OMA CAB Extensions

// ── Enums ────────────────────────────────────────────────────────

enum VCardVersion {
  VCARD_VERSION_UNSPECIFIED = 0;
  V3_0 = 1;                    // RFC 2426
  V4_0 = 2;                    // RFC 6350
}

enum TelType {
  TEL_TYPE_UNSPECIFIED = 0;
  VOICE = 1;
  TEXT = 2;
  FAX = 3;
  CELL = 4;
  VIDEO = 5;
  PAGER = 6;
}

enum AdrType {
  ADR_TYPE_UNSPECIFIED = 0;
  HOME = 1;
  WORK = 2;
}

enum EmailType {
  EMAIL_TYPE_UNSPECIFIED = 0;
  EMAIL_HOME = 1;
  EMAIL_WORK = 2;
}

// ── Structured Name (N property) ─────────────────────────────────

message VCardName {
  string family = 1;            // Family name (surname)
  string given = 2;             // Given name (first name)
  string additional = 3;        // Additional names (middle)
  string prefix = 4;            // Honorific prefix (Mr., Dr.)
  string suffix = 5;            // Honorific suffix (Jr., III)
}

// ── Address (ADR property) ───────────────────────────────────────

message VCardAddress {
  AdrType type = 1;
  string po_box = 2;
  string extended = 3;          // Extended address (apt, suite)
  string street = 4;
  string locality = 5;          // City
  string region = 6;            // State/province
  string postal_code = 7;
  string country = 8;
  string label = 9;             // Formatted address label
}

// ── Telephone (TEL property) ─────────────────────────────────────

message VCardTelephone {
  TelType type = 1;
  string value = 2;             // Phone number (tel: URI or plain)
  bool is_preferred = 3;
}

// ── Email (EMAIL property) ───────────────────────────────────────

message VCardEmail {
  EmailType type = 1;
  string value = 2;
  bool is_preferred = 3;
}

// ── Organization (ORG property) ──────────────────────────────────

message VCardOrganization {
  string name = 1;              // Organization name
  string unit = 2;              // Organizational unit (department)
}

// ── Photo/Logo (PHOTO, LOGO properties) ──────────────────────────

message VCardImage {
  string uri = 1;               // URL to image
  string media_type = 2;        // MIME type (image/png, image/jpeg)
  bytes data = 3;               // Inline binary data (base64 in jCard)
}

// ── Extended Property (X-* properties) ───────────────────────────

message VCardExtProperty {
  string name = 1;              // e.g. "X-AUTH", "X-MCP-URI"
  string value = 2;
}

// ── Full vCard (RFC 6350 §6) ─────────────────────────────────────
// Superset of InkPrincipal/InkPrincipalInfo — includes all RFC 6350
// properties used in the ink ecosystem.

message InkVCard {
  // Identification (§6.2)
  string uid = 1;               // Globally unique identifier
  VCardVersion version = 2;
  string formatted_name = 3;    // FN — display name
  VCardName name = 4;           // N — structured name components

  // Communication (§6.4)
  repeated VCardEmail emails = 5;
  repeated VCardTelephone telephones = 6;

  // Address (§6.3)
  repeated VCardAddress addresses = 7;

  // Organization (§6.6)
  VCardOrganization org = 8;
  string title = 9;             // Job title
  string role = 10;             // Functional role

  // Media (§6.2)
  VCardImage photo = 11;
  VCardImage logo = 12;

  // Web (§6.7)
  repeated string urls = 13;

  // Categories & Notes (§6.7)
  repeated string categories = 14;
  string note = 15;

  // Security (§6.8)
  string key = 16;              // Public key (PEM or URI)

  // Timestamps
  string rev = 17;              // Last revision (ISO 8601)

  // ── Ink-specific extensions ────────────────────────────────────
  bool is_llm = 18;             // true = LLM virtual principal
  repeated string roles = 19;   // ink roles: "edit", "view"
  string folder_path = 20;      // domain/user/ filesystem path
  string mcp_uri = 21;          // mcp://model:jwt@host:port/tool
  string jcard_json = 22;       // Full jCard JSON (RFC 7095) for JWT embedding

  // Custom X-* properties
  repeated VCardExtProperty ext_properties = 23;

  // Language & Locale
  string language = 24;         // LANG parameter (BCP 47: "en", "he", "ar")
  string timezone = 25;         // TZ property (IANA timezone)
}

// ── jCard (RFC 7095) ─────────────────────────────────────────────
// JSON representation of a vCard — used for JWT claims and REST APIs.

message JCard {
  string json = 1;              // Raw jCard JSON string
  InkVCard parsed = 2;          // Parsed vCard fields
}
