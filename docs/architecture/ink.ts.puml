@startuml ink.ts – TypeScript Proto-Generated Model Diagram

' ==============================================================================
' ink.ts.model — TypeScript Proto-Generated Interfaces
' Package: ink.ts.model
' Source:  ink-kmp-mcp/src/tsMain/ink/ts/model/
'
' Generated by protoc-gen-ts_proto v2.11.4 (protoc v5.28.3)
' Build script: proto-gen.sh
'
' 16 TypeScript files | 61 interfaces | 19 enums
' Each file exports:
'   - TypeScript interfaces (message types, camelCase fields)
'   - MessageFns<T> constant (fromJSON, toJSON, create, fromPartial)
'   - Enum types with fromJSON/toJSON helper functions
'   - Utility types: DeepPartial<T>, Exact<P,I>, Builtin
'
' Last updated: 2026-03-01
' ==============================================================================

skinparam backgroundColor #FAFAFA
skinparam shadowing false
skinparam roundcorner 8

skinparam class {
    BackgroundColor #E0F7FA
    BorderColor #0097A7
    HeaderBackgroundColor #00838F
    FontColor #212121
    FontName JetBrains Mono
    FontSize 11
    HeaderFontColor #FFFFFF
    HeaderFontSize 12
    AttributeFontSize 10
    StereotypeFontSize 9
}

skinparam enum {
    BackgroundColor #FFF3E0
    BorderColor #E65100
    HeaderBackgroundColor #F57C00
    FontColor #212121
    HeaderFontColor #FFFFFF
    FontSize 11
}

skinparam package {
    BackgroundColor #B2DFDB
    BorderColor #00695C
    FontColor #004D40
    FontSize 13
}

skinparam note {
    BackgroundColor #FFFDE7
    BorderColor #F9A825
    FontSize 10
    FontName JetBrains Mono
}

title ink.ts.model — TypeScript Proto-Generated Class Diagram\n16 .ts files | 61 interfaces | 19 enums | protoc-gen-ts_proto v2.11.4
footer ink.ts.model | proto-gen.sh | KT (Wire) + TS (ts_proto) + CS (protoc) + PY (protoc) | MCP + RSocket + WSS + SSE

' ===============================================================
' STORY (story.ts — story.proto)
' ===============================================================

package "story.ts" #E3F2FD {

    class Choice <<(T,#0097A7) TS>> {
        + index : number
        + text : string
        + tags : string[]
    }

    class StoryState <<(T,#0097A7) TS>> {
        + text : string
        + canContinue : boolean
        + choices : Choice[]
        + tags : string[]
    }

    class CompileResult <<(T,#0097A7) TS>> {
        + success : boolean
        + json : string
        + errors : string[]
        + warnings : string[]
    }

    class StorySession <<(T,#0097A7) TS>> {
        + id : string
        + source : string
        + stateJson : string
    }

    StoryState --> "*" Choice : choices
}

' ===============================================================
' STRUCTURE (structure.ts — structure.proto)
' ===============================================================

package "structure.ts" #E8F5E9 {

    enum SectionType <<enum>> {
        SECTION_TYPE_UNSPECIFIED = 0
        KNOT = 1
        STITCH = 2
        FUNCTION = 3
        PREAMBLE = 4
    }

    enum VariableType <<enum>> {
        VARIABLE_TYPE_UNSPECIFIED = 0
        VAR = 1
        CONST = 2
        LIST = 3
        TEMP = 4
    }

    enum DiagramMode <<enum>> {
        DIAGRAM_MODE_UNSPECIFIED = 0
        ACTIVITY = 1
        STATE = 2
    }

    class Section <<(T,#0097A7) TS>> {
        + name : string
        + type : SectionType
        + startLine : number
        + endLine : number
        + content : string
        + parent : string
        + parameters : string[]
        + lineCount : number
    }

    class Variable <<(T,#0097A7) TS>> {
        + name : string
        + type : VariableType
        + initialValue : string
        + line : number
    }

    class DivertRef <<(T,#0097A7) TS>> {
        + target : string
        + line : number
        + column : number
    }

    class Structure <<(T,#0097A7) TS>> {
        + sections : Section[]
        + variables : Variable[]
        + includes : string[]
        + diverts : DivertRef[]
        + totalLines : number
        + divertCount : number
    }

    class InkDiagramChoice <<(T,#0097A7) TS>> {
        + text : string
        + divert : string
        + isStickyChoice : boolean
    }

    Section --> SectionType : type
    Variable --> VariableType : type
    Structure --> "*" Section : sections
    Structure --> "*" Variable : variables
    Structure --> "*" DivertRef : diverts
}

' ===============================================================
' TABLE (table.ts — table.proto)
' ===============================================================

package "table.ts" #FFF3E0 {

    enum CellType <<enum>> {
        STRING = 0
        INT = 1
        FLOAT = 2
        BOOL = 3
        FORMULA = 4
        EMOJI = 5
        FAKER = 6
    }

    class MdCell <<(T,#0097A7) TS>> {
        + value : string
        + formula : string
        + evaluated : string
        + type : CellType
    }

    class MdRow <<(T,#0097A7) TS>> {
        + cells : Map<string, MdCell>
    }

    class MdTable <<(T,#0097A7) TS>> {
        + name : string
        + columns : string[]
        + rows : MdRow[]
    }

    MdCell --> CellType : type
    MdRow --> "*" MdCell : cells (map)
    MdTable --> "*" MdRow : rows
}

' ===============================================================
' DOCUMENT (document.ts — document.proto) — imports table.ts
' ===============================================================

package "document.ts" #F3E5F5 {

    enum EditorMode <<enum>> {
        EDITOR_MODE_UNSPECIFIED = 0
        EDIT = 1
        PLAY = 2
    }

    class InkFile <<(T,#0097A7) TS>> {
        + name : string
        + inkSource : string
        + headerLevel : number
    }

    class ParseResult <<(T,#0097A7) TS>> {
        + files : InkFile[]
        + tables : MdTable[]
    }

    ParseResult --> "*" InkFile : files
    ParseResult --> "*" MdTable : tables
}

' ===============================================================
' ASSET (asset.ts — asset.proto)
' ===============================================================

package "asset.ts" #B2DFDB {

    class AssetCategory <<(T,#0097A7) TS>> {
        + emoji : string
        + name : string
        + type : string
        + animSet : string
        + gripType : string
        + meshPrefix : string
        + audioCategory : string
        + unicodeGroup : string
        + unicodeSubgroup : string
        + codePoints : number[]
        + unicodeVersion : string
        + generalCategory : string
        + isGameAsset : boolean
    }

    class VoiceRef <<(T,#0097A7) TS>> {
        + characterId : string
        + language : string
        + flacPath : string
    }

    class AssetRef <<(T,#0097A7) TS>> {
        + emoji : string
        + category : AssetCategory
        + meshPath : string
        + animSetId : string
        + voiceRef : VoiceRef
        + metadata : Map<string, string>
    }

    AssetRef --> AssetCategory : category
    AssetRef --> VoiceRef : voiceRef
}

' ===============================================================
' FAKER (faker.ts — faker.proto)
' ===============================================================

package "faker.ts" #FFECB3 {

    class FakerConfig <<(T,#0097A7) TS>> {
        + seed : number
        + locale : string
        + count : number
        + level : number
        + categories : string[]
    }

    class EmojiCategory <<(T,#0097A7) TS>> {
        + emoji : string
        + fakerProvider : string
        + methodChain : string
        + rangeMin : number
        + rangeMax : number
    }
}

' ===============================================================
' EVENT (event.ts — event.proto) — imports asset.ts
' ===============================================================

package "event.ts" #FFCCBC {

    enum InventoryAction <<enum>> {
        INVENTORY_ACTION_UNSPECIFIED = 0
        EQUIP = 1
        UNEQUIP = 2
        ADD = 3
        REMOVE = 4
        USE = 5
        DROP = 6
    }

    enum LoadPriority <<enum>> {
        LOAD_PRIORITY_UNSPECIFIED = 0
        IMMEDIATE = 1
        PRELOAD = 2
        LAZY = 3
    }

    class AssetEvent <<(T,#0097A7) TS>> {
        + sessionId : string
        + eventType : string
        + asset : AssetRef
        + timestamp : number
    }

    class InventoryChangeEvent <<(T,#0097A7) TS>> {
        + sessionId : string
        + action : string
        + emoji : string
        + asset : AssetRef
        + timestamp : number
        + itemName : string
    }

    class InkTagEvent <<(T,#0097A7) TS>> {
        + sessionId : string
        + tags : string[]
        + knot : string
        + timestamp : number
        + resolvedAssets : AssetRef[]
    }

    class AssetLoadRequest <<(T,#0097A7) TS>> {
        + sessionId : string
        + asset : AssetRef
        + priority : string
        + timestamp : number
    }

    class VoiceSynthRequest <<(T,#0097A7) TS>> {
        + sessionId : string
        + text : string
        + voiceRef : VoiceRef
        + language : string
        + timestamp : number
    }

    AssetEvent --> AssetRef : asset
    InventoryChangeEvent --> AssetRef : asset
    InkTagEvent --> "*" AssetRef : resolvedAssets
    AssetLoadRequest --> AssetRef : asset
    VoiceSynthRequest --> VoiceRef : voiceRef
}

' ===============================================================
' DEBUG (debug.ts — debug.proto) — imports story.ts
' ===============================================================

package "debug.ts" #E1F5FE {

    class Breakpoint <<(T,#0097A7) TS>> {
        + id : string
        + type : string
        + target : string
        + enabled : boolean
    }

    class WatchVariable <<(T,#0097A7) TS>> {
        + name : string
        + lastValue : string
        + changeCount : number
    }

    class VisitEntry <<(T,#0097A7) TS>> {
        + step : number
        + text : string
        + choicesMade : number
        + variablesChanged : string[]
        + timestamp : number
    }

    class DebugSession <<(T,#0097A7) TS>> {
        + sessionId : string
        + breakpoints : Breakpoint[]
        + watches : Map<string, WatchVariable>
        + visitLog : VisitEntry[]
        + stepping : boolean
        + stepCount : number
        + totalSteps : number
        + isPaused : boolean
        + lastOutput : string
    }

    class WatchChange <<(T,#0097A7) TS>> {
        + oldValue : string
        + newValue : string
    }

    class StepResult <<(T,#0097A7) TS>> {
        + text : string
        + canContinue : boolean
        + choices : Choice[]
        + tags : string[]
        + hitBreakpoint : Breakpoint
        + watchChanges : Map<string, WatchChange>
        + stepNumber : number
        + isPaused : boolean
    }

    DebugSession --> "*" Breakpoint : breakpoints
    DebugSession --> "*" WatchVariable : watches (map)
    DebugSession --> "*" VisitEntry : visitLog
    StepResult --> "*" Choice : choices
    StepResult --> Breakpoint : hitBreakpoint
    StepResult --> "*" WatchChange : watchChanges (map)
}

' ===============================================================
' MCP (mcp.ts — mcp.proto)
' ===============================================================

package "mcp.ts" #F3E5F5 {

    class JsonRpcRequest <<(T,#0097A7) TS>> {
        + jsonrpc : string
        + id : string
        + method : string
        + paramsJson : string
    }

    class JsonRpcResponse <<(T,#0097A7) TS>> {
        + jsonrpc : string
        + id : string
        + resultJson : string
        + error : JsonRpcError
    }

    class JsonRpcError <<(T,#0097A7) TS>> {
        + code : number
        + message : string
        + dataJson : string
    }

    class McpServerInfo <<(T,#0097A7) TS>> {
        + name : string
        + version : string
    }

    class McpCapabilities <<(T,#0097A7) TS>> {
        + tools : McpToolCapability
    }

    class McpToolCapability <<(T,#0097A7) TS>> {
        + listChanged : boolean
    }

    class McpInitializeResult <<(T,#0097A7) TS>> {
        + protocolVersion : string
        + capabilities : McpCapabilities
        + serverInfo : McpServerInfo
    }

    class McpToolInfo <<(T,#0097A7) TS>> {
        + name : string
        + description : string
        + inputSchemaJson : string
    }

    class McpToolsListResult <<(T,#0097A7) TS>> {
        + tools : McpToolInfo[]
    }

    class McpContentBlock <<(T,#0097A7) TS>> {
        + type : string
        + text : string
    }

    class McpToolResult <<(T,#0097A7) TS>> {
        + content : McpContentBlock[]
        + isError : boolean
    }

    JsonRpcResponse --> JsonRpcError : error
    McpInitializeResult --> McpCapabilities : capabilities
    McpInitializeResult --> McpServerInfo : serverInfo
    McpCapabilities --> McpToolCapability : tools
    McpToolsListResult --> "*" McpToolInfo : tools
    McpToolResult --> "*" McpContentBlock : content
}

' ===============================================================
' LLM (llm.ts — llm.proto)
' ===============================================================

package "llm.ts" #E0F7FA {

    class GgufModel <<(T,#0097A7) TS>> {
        + id : string
        + huggingFaceRepo : string
        + fileName : string
        + parameters : string
        + quantization : string
        + architecture : string
        + sizeGb : number
        + minVramGb : number
        + jlamaCompatible : boolean
        + description : string
    }

    class ServiceDef <<(T,#0097A7) TS>> {
        + id : string
        + name : string
        + baseUrl : string
        + defaultModel : string
        + apiKeyEnv : string
        + description : string
        + requiresApiKey : boolean
        + isLocal : boolean
        + docUrl : string
    }
}

' ===============================================================
' PRINCIPAL (principal.ts — principal.proto)
' ===============================================================

package "principal.ts" #FCE4EC {

    class InkPrincipal <<(T,#0097A7) TS>> {
        + id : string
        + name : string
        + roles : string[]
        + isLlm : boolean
        + email : string
    }

    class InkPrincipalInfo <<(T,#0097A7) TS>> {
        + id : string
        + displayName : string
        + email : string
        + role : string
        + isLlm : boolean
        + folderPath : string
        + mcpUri : string
    }
}

' ===============================================================
' CALENDAR (calendar.ts — calendar.proto)
' ===============================================================

package "calendar.ts" #F1F8E9 {

    class InkEvent <<(T,#0097A7) TS>> {
        + uid : string
        + summary : string
        + description : string
        + dtStart : string
        + dtEnd : string
        + category : string
        + location : string
        + status : string
    }
}

' ===============================================================
' COLLAB (collab.ts — collab.proto)
' ===============================================================

package "collab.ts" #EDE7F6 {

    class ColabClient <<(T,#0097A7) TS>> {
        + clientId : string
        + docId : string
    }

    class ColabDocumentInfo <<(T,#0097A7) TS>> {
        + docId : string
        + createdAt : number
        + updateCount : number
        + clientCount : number
    }

    class EditorContext <<(T,#0097A7) TS>> {
        + mode : string
        + sessionId : string
        + docId : string
        + isCompiling : boolean
        + errors : string[]
    }
}

' ===============================================================
' SILLYTAVERN (sillytavern.ts — sillytavern.proto)
' ===============================================================

package "sillytavern.ts" #FFF9C4 {

    class StCharacterCard <<(T,#0097A7) TS>> {
        + name : string
        + description : string
        + personality : string
        + scenario : string
        + firstMessage : string
        + mesExample : string
        + systemPrompt : string
        + creatorNotes : string
        + tags : string[]
    }
}

' ===============================================================
' ICAL (ical.ts — ical.proto) — RFC 5545 calendar types
' ===============================================================

package "ical.ts" #F1F8E9 {

    enum EventStatus <<enum>> {
        TENTATIVE = 1
        CONFIRMED = 2
        CANCELLED = 3
    }

    enum TodoStatus <<enum>> {
        NEEDS_ACTION = 1
        COMPLETED = 2
        IN_PROCESS = 3
        TODO_CANCELLED = 4
    }

    enum ParticipationStatus <<enum>> {
        ACCEPTED = 1
        DECLINED = 2
        TENTATIVE_PARTSTAT = 3
        DELEGATED = 4
        ..
    }

    enum ParticipantRole <<enum>> {
        CHAIR = 1
        REQ_PARTICIPANT = 2
        OPT_PARTICIPANT = 3
        NON_PARTICIPANT = 4
    }

    enum RecurrenceFrequency <<enum>> {
        SECONDLY = 1
        MINUTELY = 2
        HOURLY = 3
        DAILY = 4
        WEEKLY = 5
        MONTHLY = 6
        YEARLY = 7
    }

    enum Weekday <<enum>> {
        SUNDAY = 1
        MONDAY = 2
        ..
        SATURDAY = 7
    }

    enum AlarmAction <<enum>> {
        DISPLAY = 1
        AUDIO = 2
        EMAIL = 3
    }

    enum Transparency <<enum>> {
        OPAQUE = 1
        TRANSPARENT_TIME = 2
    }

    enum AccessClassification <<enum>> {
        PUBLIC = 1
        PRIVATE = 2
        CONFIDENTIAL = 3
    }

    class WeekdayNum <<(T,#0097A7) TS>> {
        + weekday : Weekday
        + ordinal : number
    }

    class RecurrenceRule <<(T,#0097A7) TS>> {
        + frequency : RecurrenceFrequency
        + until : string
        + count : number
        + interval : number
        + byDay : WeekdayNum[]
        + byMonth : number[]
        + byMonthDay : number[]
        + byHour : number[]
        + byMinute : number[]
        + bySecond : number[]
        + bySetPos : number[]
        + weekStart : Weekday
    }

    class Attendee <<(T,#0097A7) TS>> {
        + email : string
        + commonName : string
        + role : ParticipantRole
        + participationStatus : ParticipationStatus
        + rsvp : boolean
        + delegatedTo : string
        + delegatedFrom : string
        + sentBy : string
    }

    class Organizer <<(T,#0097A7) TS>> {
        + email : string
        + commonName : string
        + sentBy : string
    }

    class Alarm <<(T,#0097A7) TS>> {
        + action : AlarmAction
        + trigger : string
        + duration : ICalDuration
        + repeat : number
        + description : string
        + summary : string
        + attendees : Attendee[]
    }

    class ICalDuration <<(T,#0097A7) TS>> {
        + isNegative : boolean
        + weeks : number
        + days : number
        + hours : number
        + minutes : number
        + seconds : number
    }

    class GeoPosition <<(T,#0097A7) TS>> {
        + latitude : number
        + longitude : number
    }

    class VEvent <<(T,#0097A7) TS>> {
        + uid : string
        + summary : string
        + description : string
        + dtStart : string
        + dtEnd : string
        + location : string
        + status : EventStatus
        + organizer : Organizer
        + attendees : Attendee[]
        + recurrenceRule : RecurrenceRule
        + alarms : Alarm[]
        + categories : string[]
        + geo : GeoPosition
        + transparency : Transparency
        + classification : AccessClassification
        + url : string
        + created : string
        + lastModified : string
        + sequence : number
    }

    class VTodo <<(T,#0097A7) TS>> {
        + uid : string
        + summary : string
        + description : string
        + dtStart : string
        + due : string
        + status : TodoStatus
        + priority : number
        + percentComplete : number
        + organizer : Organizer
        + attendees : Attendee[]
        + alarms : Alarm[]
        + categories : string[]
    }

    class VJournal <<(T,#0097A7) TS>> {
        + uid : string
        + summary : string
        + description : string
        + dtStart : string
        + status : EventStatus
        + organizer : Organizer
        + attendees : Attendee[]
        + categories : string[]
    }

    class VCalendar <<(T,#0097A7) TS>> {
        + prodId : string
        + version : string
        + calScale : string
        + method : string
        + events : VEvent[]
        + todos : VTodo[]
        + journals : VJournal[]
    }

    WeekdayNum --> Weekday : weekday
    RecurrenceRule --> RecurrenceFrequency : frequency
    RecurrenceRule --> "*" WeekdayNum : byDay
    Attendee --> ParticipantRole : role
    Attendee --> ParticipationStatus : participationStatus
    Alarm --> AlarmAction : action
    Alarm --> ICalDuration : duration
    Alarm --> "*" Attendee : attendees
    VEvent --> EventStatus : status
    VEvent --> Organizer : organizer
    VEvent --> "*" Attendee : attendees
    VEvent --> RecurrenceRule : recurrenceRule
    VEvent --> "*" Alarm : alarms
    VEvent --> GeoPosition : geo
    VEvent --> Transparency : transparency
    VEvent --> AccessClassification : classification
    VTodo --> TodoStatus : status
    VTodo --> Organizer : organizer
    VTodo --> "*" Attendee : attendees
    VTodo --> "*" Alarm : alarms
    VJournal --> EventStatus : status
    VJournal --> Organizer : organizer
    VJournal --> "*" Attendee : attendees
    VCalendar --> "*" VEvent : events
    VCalendar --> "*" VTodo : todos
    VCalendar --> "*" VJournal : journals
}

' ===============================================================
' VCARD (vcard.ts — vcard.proto) — RFC 6350 contact types
' ===============================================================

package "vcard.ts" #FCE4EC {

    enum VCardVersion <<enum>> {
        V3_0 = 1
        V4_0 = 2
    }

    enum TelType <<enum>> {
        VOICE = 1
        TEXT = 2
        FAX = 3
        CELL = 4
        VIDEO = 5
        PAGER = 6
    }

    enum AdrType <<enum>> {
        HOME = 1
        WORK = 2
    }

    enum EmailType <<enum>> {
        HOME_EMAIL = 1
        WORK_EMAIL = 2
    }

    class VCardName <<(T,#0097A7) TS>> {
        + family : string
        + given : string
        + additional : string
        + prefix : string
        + suffix : string
    }

    class VCardAddress <<(T,#0097A7) TS>> {
        + type : AdrType
        + poBox : string
        + extended : string
        + street : string
        + locality : string
        + region : string
        + postalCode : string
        + country : string
        + label : string
    }

    class VCardTelephone <<(T,#0097A7) TS>> {
        + type : TelType
        + value : string
        + isPreferred : boolean
    }

    class VCardEmail <<(T,#0097A7) TS>> {
        + type : EmailType
        + value : string
        + isPreferred : boolean
    }

    class VCardOrganization <<(T,#0097A7) TS>> {
        + name : string
        + unit : string
    }

    class VCardImage <<(T,#0097A7) TS>> {
        + uri : string
        + mediaType : string
        + data : Uint8Array
    }

    class VCardExtProperty <<(T,#0097A7) TS>> {
        + name : string
        + value : string
    }

    class InkVCard <<(T,#0097A7) TS>> {
        + uid : string
        + version : VCardVersion
        + formattedName : string
        + name : VCardName
        + emails : VCardEmail[]
        + telephones : VCardTelephone[]
        + addresses : VCardAddress[]
        + org : VCardOrganization
        + title : string
        + role : string
        + photo : VCardImage
        + logo : VCardImage
        + urls : string[]
        + categories : string[]
        + note : string
        + key : string
        + rev : string
        + isLlm : boolean
        + roles : string[]
        + folderPath : string
        + mcpUri : string
        + jcardJson : string
        + extProperties : VCardExtProperty[]
        + language : string
        + timezone : string
    }

    class JCard <<(T,#0097A7) TS>> {
        + json : string
        + parsed : InkVCard
    }

    VCardAddress --> AdrType : type
    VCardTelephone --> TelType : type
    VCardEmail --> EmailType : type
    InkVCard --> VCardVersion : version
    InkVCard --> VCardName : name
    InkVCard --> "*" VCardEmail : emails
    InkVCard --> "*" VCardTelephone : telephones
    InkVCard --> "*" VCardAddress : addresses
    InkVCard --> VCardOrganization : org
    InkVCard --> VCardImage : photo
    InkVCard --> VCardImage : logo
    InkVCard --> "*" VCardExtProperty : extProperties
    JCard --> InkVCard : parsed
}

' ===============================================================
' CROSS-FILE DEPENDENCY ARROWS
' ===============================================================

' document.ts imports MdTable from table.ts
ParseResult ..> MdTable : imports table.ts

' event.ts imports AssetRef, VoiceRef from asset.ts
AssetEvent ..> AssetRef : imports asset.ts
InventoryChangeEvent ..> AssetRef : imports asset.ts
InkTagEvent ..> AssetRef : imports asset.ts
AssetLoadRequest ..> AssetRef : imports asset.ts
VoiceSynthRequest ..> VoiceRef : imports asset.ts

' debug.ts imports Choice from story.ts
StepResult ..> Choice : imports story.ts

' ===============================================================
' NOTES
' ===============================================================

note as N1
  **ink.ts.model — TypeScript Proto-Generated Interfaces**
  ======================================================

  **Generator:** protoc-gen-ts_proto v2.11.4
  **Protoc:** v5.28.3
  **Build:** proto-gen.sh
  **Source:** ink-kmp-mcp/src/tsMain/ink/ts/model/

  **16 files | 61 interfaces | 19 enums**

  | Source file | Interfaces | Enums |
  | story.ts | 4 | 0 |
  | structure.ts | 5 | 3 |
  | table.ts | 3 | 1 |
  | document.ts | 2 | 1 |
  | asset.ts | 3 | 0 |
  | faker.ts | 2 | 0 |
  | event.ts | 5 | 2 |
  | debug.ts | 6 | 0 |
  | mcp.ts | 11 | 0 |
  | llm.ts | 2 | 0 |
  | principal.ts | 2 | 0 |
  | calendar.ts | 1 | 0 |
  | collab.ts | 3 | 0 |
  | sillytavern.ts | 1 | 0 |
  | ical.ts | 11 | 9 |
  | vcard.ts | 9 | 4 |

  **Per-file exports (ts_proto pattern):**
  - ""export interface Foo { ... }"" — message type
  - ""export const Foo: MessageFns<Foo>"" — fromJSON, toJSON, create, fromPartial
  - ""export enum Bar { ... }"" — enum type
  - ""export function barFromJSON()"" / ""barToJSON()"" — enum helpers

  **Utility types (per file):**
  - ""DeepPartial<T>"" — recursive Partial
  - ""Exact<P, I>"" — strict type guard
  - ""type Builtin"" — Date | Function | Uint8Array | string | number | boolean
end note

note as N2
  **Cross-Language Protobuf Interop Stack**
  ==========================================

  **Code-first pipeline (Kotlin source of truth):**

  | Target | Generator | Wire Format |
  | **Kotlin** | Wire (Square) | protobuf/msgpack |
  | **TypeScript** | protoc-gen-ts_proto | JSON (camelCase) |
  | **C#** | protoc --csharp_out | protobuf binary |
  | **Python** | protoc --python_out | protobuf binary |

  **Build:** proto-gen.sh orchestrates all targets
  **Source:** Kotlin data classes + @Proto annotations
  **Output:** .proto -> per-language stubs

  **Planned interop:**
  - **MagicOnion** — Unity/C# gRPC (planned)
  - **RSocket** — KT <-> TS reactive streams
  - **MCP** — JSON-RPC tool schemas
  - **AsyncAPI** — WSS/SSE event streaming

  **TS-specific conventions:**
  - camelCase fields (proto snake_case -> TS camelCase)
  - ""number"" for int32/int64/double/float
  - ""boolean"" for bool
  - ""string"" for string/bytes
  - ""Uint8Array"" for binary data (vcard.ts VCardImage)
  - ""Map<K,V>"" for proto map fields
end note

note as N_PROGRESS
  **Generation Progress: 16/16 complete**
  ========================================

  [x] story.ts        — 4 interfaces
  [x] structure.ts    — 5 interfaces, 3 enums
  [x] table.ts        — 3 interfaces, 1 enum
  [x] document.ts     — 2 interfaces, 1 enum
  [x] asset.ts        — 3 interfaces
  [x] faker.ts        — 2 interfaces
  [x] event.ts        — 5 interfaces, 2 enums
  [x] debug.ts        — 6 interfaces
  [x] mcp.ts          — 11 interfaces
  [x] llm.ts          — 2 interfaces
  [x] principal.ts    — 2 interfaces
  [x] calendar.ts     — 1 interface
  [x] collab.ts       — 3 interfaces
  [x] sillytavern.ts  — 1 interface
  [x] ical.ts         — 11 interfaces, 9 enums
  [x] vcard.ts        — 9 interfaces, 4 enums

  All 16 TypeScript files generated from
  proto-gen.sh via protoc-gen-ts_proto v2.11.4.
end note

N1 .. StoryState
N2 .. CompileResult
N_PROGRESS .. GgufModel

' ===============================================================
' LEGEND
' ===============================================================

legend bottom right
  |= Color |= Source File |= Domain |
  | <#E3F2FD> | story.ts | narrative state |
  | <#E8F5E9> | structure.ts | ink document structure |
  | <#FFF3E0> | table.ts | MD data tables |
  | <#F3E5F5> | document.ts / mcp.ts | file + protocol |
  | <#B2DFDB> | asset.ts | emoji/mesh/anim/voice |
  | <#FFECB3> | faker.ts | data generation |
  | <#FFCCBC> | event.ts | RSocket events |
  | <#E1F5FE> | debug.ts | breakpoints/watch |
  | <#E0F7FA> | llm.ts | model definitions |
  | <#FCE4EC> | principal.ts / vcard.ts | auth/identity/contacts |
  | <#F1F8E9> | calendar.ts / ical.ts | iCal events (RFC 5545) |
  | <#EDE7F6> | collab.ts | Yjs sessions |
  | <#FFF9C4> | sillytavern.ts | character cards |
endlegend

@enduml
